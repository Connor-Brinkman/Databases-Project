<!DOCTYPE html>
<html>
    <head>
        <title>User Data</title>
    </head>
    <body>
        <table id = "userDataTable">
            <thead>
                <th>Nickname</th>
                <th>Email</th>
                <th>Registration Date</th>
            </thead>
            <tbody>
                
            </tbody>
        </table>
        <button id = "logout" type = 'click'>Logout</button>
        <button id = 'deleteUser' type =  'submit'>Delete User</button>
    </body>
    <script>
        const dataTable = document.getElementById('userDataTable');

        fetch('/bridge/get_user_data')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.length === 0) {
                dataTable.innerHTML = "<tr><td colspan='100%'>No data available</td></tr>";
                return;
            }

            const actualData = data[0][0];  // Get the inner list
            if (!actualData || actualData.length === 0)
            {
                dataTable.innerHTML = "<tr><td colspan='100%'>No data available</td></tr>";
                return;
            }
            
            let row = dataTable.insertRow()
            
            for(var i = 0; i < actualData.length; i++) {
                let cell = row.insertCell(i)
                cell.innerHTML = actualData[i]
            }

        
    })
    .catch(error => {
        console.error('Error fetching data:', error);
        dataTable.innerHTML = `<tr><td colspan='100%' style='color:red;'>Error fetching data: ${error}</td></tr>`;
    });
    </script>

    <script>
        document.getElementById('logout').addEventListener('click', function() {
            fetch('/logoutUser')
            .then(response => {
                if (response.ok) {
                    window.location.href = '/'
                }
                else {
                    alert('An error has occured! Please try again later.')
                }
            })
        })
    </script>

    <script>
        document.getElementById('deleteUser').addEventListener('click', function() {
            fetch('/bridge/deleteUser')
            .then(response => {
                if (response.ok) {
                    window.location.href = '/'
                }
                else {
                    alert('An error has occured! Please try again later.')
                }
            })
        })
    </script>
</html>