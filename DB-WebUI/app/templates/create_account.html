<!DOCTYPE html>
<html>
    <head>
        <title>
            Create Account
        </title>
    </head>
    
    <body>
        <header>
            Create Account
        </header>
        <form id="createAccForm">
            <div>
              <label for="nickname">Nickname:</label>
              <input type="text" id="nickname" name="nickname">
            </div>
            <br>
            <div>
              <label for="email">Email:</label>
              <input type="text" id="email" name="email">
            </div>
            <br>
            <div>
              <label for="password">Password:</label>
              <input type="password" id="password" name="password">
            </div>
             <br>
            <div>
              <label for="repeatPassword">Repeat Password:</label>
              <input type="password" id="repeatPassword" name="repeatPassword">
            </div>
            <br>
            <button type="submit">Create Account</button>
          </form>

        <script>
          document.getElementById('createAccForm').addEventListener('submit', function(event) {
              event.preventDefault();

              const nickname = document.getElementById('nickname').value;
              const email = document.getElementById('email').value;
              const password = document.getElementById('password').value;
              const repeatPassword = document.getElementById('repeatPassword').value;

              if (!nickname || !email || !password || !repeatPassword) {
                  alert('Please fill in all fields.');
                  return;
              }

              if (password !== repeatPassword) {
                  alert('Passwords do not match.');
                  return;
              }

              const data = {
                  nickname: nickname,
                  email: email,
                  password: password,
              };

              fetch('/bridge/create_account', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(data),
              })
              .then(response => {
                  if (!response.ok) {
                      throw new Error(`HTTP error! status: ${response.status}`);
                  }
                  return response.json();
              })
              .then(responseData => {
                  console.log('Success:', responseData);
                  alert('Account created successfully!');
                  window.location.href = "/";
              })
              .catch(error => {
                  console.error('Error:', error);
                  alert(`Failed to create account. ${error}`);
              });
          });
        </script>
    </body>
</html>
